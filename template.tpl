___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Campaign Collector",
  "categories": ["ATTRIBUTION", "DATA_WAREHOUSING", "MARKETING"],
  "brand": {
    "id": "level_agency",
    "displayName": "Level Agency",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAIAAAAErfB6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAylpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAxIDc5LjE0NjI4OTk3NzcsIDIwMjMvMDYvMjUtMjM6NTc6MTQgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjIwMTY0NzA0QzNFNjExRUY4QUU1QTM0NEY2MjVBRUJEIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjIwMTY0NzAzQzNFNjExRUY4QUU1QTM0NEY2MjVBRUJEIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyNS4wIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OURCMzY3ODM4RjBBMTFFRkFCMzJDQjBDODA3QjA2MEYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OURCMzY3ODQ4RjBBMTFFRkFCMzJDQjBDODA3QjA2MEYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5ehqWNAAAHT0lEQVR42uzd30tT/x8H8Jr7oYabm7Yfjomy2lZUtOX6uXaXIAOtLrSLriQK+ieiugkK6ia7qEDpF8QQlmuWhBXM0KyE1QympaWZmq75Ize3qd8XDbr6XHzhrPd5d3w+LsS7c97v1877vF7ndX5s2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAErKR5cbUarXH46moqEin0+IOWy6Xp1Kpvr6+T58+IcD5YbVaz549e/ToUaPRmMlk1tbWxA3w8vJyOBxuaWnp6urCgS5UUVHRpUuXstnsGme6u7urqqokPPMyNpvZv38/HbsFBQW8jd/lcvl8Pg537B8L8JYtWywWC4fj12g0+/btKywsRIAFoYxG9MTqP62urv769WtlZQUBFiQSicRiMQ7H/+PHj1AoRAmXVAPM6NwzMzOjUqloMaRsi5/BU9LX1tZ28+ZNyuqlGmA5m83QGnj37t1kMtnY2OhwOJRKpYirokwmo/x5eHi4o6Pj/v37S0tLqIPzxm63U1miUCjo5CfamDdupACPjY1Fo1ERdwMAAAAAkEX/P6xWK5VJNputoKBA3G4SJdJUmj9+/Li7u1vcPZEOr9f79OlTKoX5aSVFIpGTJ09KuNPAjsFgePDgwRp/KMYej0fCM8/oWvTevXv5nEe73V5bW6tQKBBgQYxGo06n43D8SqWyuroaARZqfn6ez0u+lBN8/fo1m80iwIKEw+FXr15xOP7x8fFgMMhnrzovGCWQCwsLP3/+3L17d1lZmUwm42HklGHF4/EbN274/X4JtxzY1cF0nnO73T6fj855uX6OmAuXTEbRff78+bNnz+iXhwsdeVNYWKjVakUPMO0A5QSJRAIVLAAAAEgiySopKaF0mocGDu0DFW8SviOadYDlcvmRI0eam5v1er3oAaYsmkLb0dHR1tZG9RIO9DxoamoaGRnhqpVEldK1a9e4ulX7X2W323Otdd6Mj4/7fD4Jzzy7dqHL5eJw/OXl5V6vV6lUIsCCFBcX8zmJKpXKZDKhXSjUly9fpqenORz/4uLiwMBAKpVCgAXp7e3t7OzksGnz/v37QCAg4WKJ0cNniUTi8uXLpaWldXV1tCqKe1dlrtWRyWSi0ejFixc/f/6MOjg/DAbD4cOHd+3aRZEW8YlN+nnRITs4OPjixQu8ZedvJVyiP124sLCAO6IBAABAEklWUVFRZWWl2WymPEvEJEsmk1EWPTU1NTo6KvlWErsAm0ym06dPNzU16fV6HkaeTqe7urqoDpZ8pcSCXC6/cOFCKpXirZv08OFDo9GIAAnlcrn6+/s5bBfSEn3q1ClO7sX/K+cjNptxOp0Oh4PD8avVarfbjXdVCj7V/8bnFFC6J+FLWuzeVTk8PMzh+BOJBJ07JPyuSkYBfvfuXXt7O4dPkL58+TIUCkn44TNG7cJsNtvS0kL/nDhxQqvV8nBXZa5MunLlyuTkJOrg/KBcpqqqisoSqppE7wfT4kxnjbm5OdQ4AAAAAMBzFq3X6w8cOGA2m3n48hkV5W/evBkcHESA88Nms50/f76urk7cO+7+VEokFoudO3cuEAjgQBdKp9PdunUrd9WXK/39/Vu3bpXwzLP7tF1tbS2H/YZt27Y1NDTg03ZCWSyWzZs3czj+TZs2OZ1OtAuFWlxcTCaTHI4/m81OT0/jXZVC0aluYGCAw/FPTk4+efIEn7YTanZ2liaxpqamtLSUn8HTunL79u3W1lYJP13ILuuRyWT19fXNzc0mk0mlUon7bBJtPR6P+/3+e/fuzc/Pow7Om5KSkvLyco1GI+590bSc0OKcSCTw/BkAAABIIsmi/NlgMIj+QnBRUvdMJjM1NcW4JNvIMrROp7OhocHhcOQKlXUVYErdU6lUNBoNBoORSESClTcVwR8+fOCwocQSxbW3t9fr9UotuiaTKRAIrMFvra2tZWVljFYONps5ePCg2+1GypPj8XhqamokFWCdTqfRaBDaP7PB7EN/jAI8MTExMzOD0OZQLv3t2zdJBbivr6+npwehzQmHw5RvstkWo3bh0tLS7OxsdXW12Wxezx9kTiaTnZ2dV69eZfZiEKYXOrZv337s2DGLxbI+L3TQ36GhIb/fPzo6imUMAAAA4J9O7hhvr6KiYufOnWq1WsK3Iv9nCr26ujo3N/fx40fGrwRhF+Di4uL6+vrjx4/v2bNHq9WuqwBv+P02rng8HolEqEwKBoNS+86LXC4/c+bM9+/f0UoaGxtrbGyU2u+Xjtq3b98iujmhUKiyspLNzDO6Fr1jxw6r1YqU58/PnVnzlFGAFQoFrdII7Z/ZYPYxPUYBHhkZmZiYQGhzKJdm9uoIRgF+/fp1e3t7Op1GdCl/fvToUTQaZbM5Rp07Cu3Q0NDKyorFYlnPt3bEYrHr16/fuXMnkUhI8EIHhfbQoUM2m02lUq3DduHy8jLVwT09PRJ+HBkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/q7/CTAAJwaSJVMXvNQAAAAASUVORK5CYII\u003d"
  },
  "description": "Stores, persists, and collects campaign data (utm_ parameters + custom parameters) via hidden fields in your webforms - complete with custom fieldMapping.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "type",
    "displayName": "Type/Action",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "config",
        "displayValue": "Setup/Config"
      },
      {
        "value": "lead",
        "displayValue": "Measure Lead"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "instanceKey",
    "displayName": "Instance Name",
    "simpleValueType": true,
    "help": "Use this if you wish to access the instance outside of this tag template (e.g. Custom HTML tags and/or other custom code) -OR- if you need several instances. It will be stored as a property of the _campaignCollector global.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "alpha|beta|gamma"
        ]
      }
    ],
    "defaultValue": "alpha"
  },
  {
    "type": "TEXT",
    "name": "fieldMapAnonymousId",
    "displayName": "Anonymous ID Field Key",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ],
    "valueHint": "cc_anonymous_id",
    "help": "Customize the field the campaign collector anonymous id will be loaded into."
  },
  {
    "type": "TEXT",
    "name": "fieldMapAttributionJson",
    "displayName": "Attribution JSON Field Key",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ],
    "valueHint": "cc_attribution_json",
    "help": "Customize the field the bulk JSON attribution data will be loaded into."
  },
  {
    "type": "TEXT",
    "name": "fieldMapConsent",
    "displayName": "Consent JSON Field Key",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ],
    "valueHint": "cc_consent_json",
    "help": "Customize the field that the consent JSON will be loaded into."
  },
  {
    "type": "GROUP",
    "name": "firstTouch",
    "displayName": "First Touch (Original Session)",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "TEXT",
        "name": "firstPartyEndpoint",
        "displayName": "First Party Endpoint",
        "simpleValueType": true,
        "valueValidators": [],
        "help": "Measuring first touch requires setting a cookie that \"never expires\". Many browsers cap cookies set by javascript to a 7 day maximum. In order to get around this, you will need to set the 1st touch cookies via your own first party endpoint/server (such as a Server-Side GTM Client). \u003cstrong\u003eIf you do not set your cookies through a first party endpoint, the \"first touch\" will reset every 7 days in certain browsers.\u003c/strong\u003e\n\n\u003cbr\u003e\u003cbr\u003eNote -- Your endpoint must support HTTPS protocol.",
        "valueHint": "data.your-domain.com/1pc"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldMapStandardFirst",
        "displayName": "Standard Parameter: Field Map",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "source",
                "displayValue": "utm_source"
              },
              {
                "value": "medium",
                "displayValue": "utm_medium"
              },
              {
                "value": "campaign",
                "displayValue": "utm_campaign"
              },
              {
                "value": "term",
                "displayValue": "utm_term"
              },
              {
                "value": "content",
                "displayValue": "utm_content"
              },
              {
                "value": "id",
                "displayValue": "utm_id"
              },
              {
                "value": "source_platform",
                "displayValue": "utm_source_platform"
              },
              {
                "value": "marketing_tactic",
                "displayValue": "utm_marketing_tactic"
              },
              {
                "value": "creative_format",
                "displayValue": "utm_creative_format"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "field",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "isUnique": true
          }
        ],
        "newRowButtonText": "Add Mapping",
        "help": "The 9 supported \"utm_\" parameters \u003ca href\u003d\"https://support.google.com/analytics/answer/10917952?hl\u003den#parameters\u0026zippy\u003d%2Cin-this-article\" target\u003d\"_blank\"\u003eas defined by Google\u003c/a\u003e commonly used to measure campaign performance.",
        "notSetText": "No field mapping set, assumes fields will match standard utm_* parameter names appended with \"_1st\"."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldMapCustomFirst",
        "displayName": "Custom Parameter: Field Map",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "platform",
                "displayValue": "platform"
              },
              {
                "value": "source",
                "displayValue": "source"
              },
              {
                "value": "campaign",
                "displayValue": "campaign"
              },
              {
                "value": "campaign_name",
                "displayValue": "campaign_name"
              },
              {
                "value": "group",
                "displayValue": "group"
              },
              {
                "value": "ad",
                "displayValue": "ad"
              },
              {
                "value": "creative",
                "displayValue": "creative"
              },
              {
                "value": "feed",
                "displayValue": "feed"
              },
              {
                "value": "product",
                "displayValue": "product"
              },
              {
                "value": "extension",
                "displayValue": "extension"
              },
              {
                "value": "geo_int",
                "displayValue": "geo_int"
              },
              {
                "value": "geo_phy",
                "displayValue": "geo_phy"
              },
              {
                "value": "device",
                "displayValue": "device"
              },
              {
                "value": "matchtype",
                "displayValue": "matchtype"
              },
              {
                "value": "placement",
                "displayValue": "placement"
              },
              {
                "value": "target",
                "displayValue": "target"
              },
              {
                "value": "network",
                "displayValue": "network"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "field",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "isUnique": true
          }
        ],
        "newRowButtonText": "Add Mapping",
        "help": "Custom parameters that are often used for advanced campaign measurement. The parameter names will use the \"namespace\" defined under advanced settings for each parameters prefix (lvl by default).",
        "notSetText": "No field mapping set, assumes fields will match custom parameter names appended with \"_1st\"."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "lastTouch",
    "displayName": "Last Touch (Active Session)",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "TEXT",
        "name": "sessionTimeout",
        "displayName": "Session Timeout (in Minutes)",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ],
        "valueHint": "default: 30",
        "valueUnit": "minutes",
        "help": "Can be a value in minutes between 30 and 475 (7 hours and 55 minutes). It is suggested to align this timeout with your primary analytics tool timeout setting (such as GA4). Defaults to 30 minutes to match the default GA4 session timeout setting."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldMapStandardLast",
        "displayName": "Standard Parameter: Field Map",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "source",
                "displayValue": "utm_source"
              },
              {
                "value": "medium",
                "displayValue": "utm_medium"
              },
              {
                "value": "campaign",
                "displayValue": "utm_campaign"
              },
              {
                "value": "term",
                "displayValue": "utm_term"
              },
              {
                "value": "content",
                "displayValue": "utm_content"
              },
              {
                "value": "id",
                "displayValue": "utm_id"
              },
              {
                "value": "source_platform",
                "displayValue": "utm_source_platform"
              },
              {
                "value": "marketing_tactic",
                "displayValue": "utm_marketing_tactic"
              },
              {
                "value": "creative_format",
                "displayValue": "utm_creative_format"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "field",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "isUnique": true
          }
        ],
        "newRowButtonText": "Add Mapping",
        "help": "The 9 supported \"utm_\" parameters \u003ca href\u003d\"https://support.google.com/analytics/answer/10917952?hl\u003den#parameters\u0026zippy\u003d%2Cin-this-article\" target\u003d\"_blank\"\u003eas defined by Google\u003c/a\u003e commonly used to measure campaign performance.",
        "notSetText": "No field mapping set, assumes fields will match standard utm_* parameter names."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldMapCustomLast",
        "displayName": "Custom Parameter: Field Map",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "platform",
                "displayValue": "platform"
              },
              {
                "value": "source",
                "displayValue": "source"
              },
              {
                "value": "campaign",
                "displayValue": "campaign"
              },
              {
                "value": "campaign_name",
                "displayValue": "campaign_name"
              },
              {
                "value": "group",
                "displayValue": "group"
              },
              {
                "value": "ad",
                "displayValue": "ad"
              },
              {
                "value": "creative",
                "displayValue": "creative"
              },
              {
                "value": "feed",
                "displayValue": "feed"
              },
              {
                "value": "product",
                "displayValue": "product"
              },
              {
                "value": "extension",
                "displayValue": "extension"
              },
              {
                "value": "geo_int",
                "displayValue": "geo_int"
              },
              {
                "value": "geo_phy",
                "displayValue": "geo_phy"
              },
              {
                "value": "device",
                "displayValue": "device"
              },
              {
                "value": "matchtype",
                "displayValue": "matchtype"
              },
              {
                "value": "placement",
                "displayValue": "placement"
              },
              {
                "value": "target",
                "displayValue": "target"
              },
              {
                "value": "network",
                "displayValue": "network"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "field",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "isUnique": true
          }
        ],
        "newRowButtonText": "Add Mapping",
        "help": "Custom parameters that are often used for advanced campaign measurement. The parameter names will use the \"namespace\" defined under advanced settings for each parameters prefix (lvl by default).",
        "notSetText": "No field mapping set, assumes fields will match custom parameter names."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "cookiesAndGlobals",
    "displayName": "Cookies \u0026 Globals",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldMapCookies",
        "displayName": "Cookies",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "REGEX",
                "args": [
                  "[_\\-a-zA-Z0-9]+"
                ]
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "field",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "newRowButtonText": "Add Cookie",
        "alwaysInSummary": false
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "fieldMapGlobals",
        "displayName": "Globals",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Path",
            "name": "path",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "REGEX",
                "args": [
                  "^[a-zA-Z_]+\\.[a-zA-Z_]+"
                ]
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Field",
            "name": "field",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "newRowButtonText": "Add Global"
      },
      {
        "type": "TEXT",
        "name": "filters",
        "displayName": "Filters",
        "simpleValueType": true,
        "help": "You may define filters via a custom javascript variable that returns an object of callbacks. See examples in our \u003ca href\u003d\"#\"\u003edocumentation\u003c/a\u003e.\u003cbr\u003e\u003cbr\u003e\nFilters are only run on Cookie and Global values when filled into individual fields - they are not applied to campaign parameters or the Attribution JSON."
      },
      {
        "type": "CHECKBOX",
        "name": "useCommonCookieFilters",
        "checkboxText": "Use common filters for popular adtech/martech cookies.",
        "simpleValueType": true,
        "help": "If checked, filters will be applied to extract the meaningful  information for the following cookies automatically: _ga, _gcl_aw, _gcl_gb, _gcl_ag, _uetmsclkid."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "fieldTargetMethods",
    "displayName": "Field Targeting Options",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "fieldTargetByName",
        "checkboxText": "Input \"name\" attribute",
        "simpleValueType": true,
        "defaultValue": true,
        "alwaysInSummary": true
      },
      {
        "type": "CHECKBOX",
        "name": "fieldTargetByClass",
        "checkboxText": "CSS class",
        "simpleValueType": true
      },
      {
        "type": "CHECKBOX",
        "name": "fieldTargetByParentClass",
        "checkboxText": "CSS class on parent element(s)",
        "simpleValueType": true
      },
      {
        "type": "CHECKBOX",
        "name": "fieldTargetByCustomAttribute",
        "checkboxText": "Input data attribute",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "fieldDataAttribute",
            "displayName": "Custom Data Attribute",
            "simpleValueType": true,
            "valueHint": "default: data-campaign-collector",
            "valueValidators": [
              {
                "type": "REGEX",
                "args": [
                  "data-[a-z\\-]+[a-z]+$"
                ]
              }
            ],
            "enablingConditions": [
              {
                "paramName": "fieldTargetByCustomAttribute",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Will fill fields with a specific data-attribute and value."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "miscOptions",
    "displayName": "Misc. Options",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "TEXT",
        "name": "namespace",
        "displayName": "Namespace (e.g. Custom Parameter Prefix)",
        "simpleValueType": true,
        "help": "You may define a custom namespace for the non-standard campaign parameters you would like to collect. (Default: lvl).",
        "valueValidators": [
          {
            "type": "REGEX",
            "args": [
              "([a-z0-9]{2,4})?"
            ]
          }
        ],
        "valueHint": "default: lvl"
      },
      {
        "type": "TEXT",
        "name": "storageDomain",
        "displayName": "Storage (Cookie) Domain",
        "simpleValueType": true,
        "valueHint": "auto",
        "help": "If you need to explicitly set what domain the script should use for cookie storage, you can set it here. By default it will attempt  to  extract the root domain - but  for odd domains on weird TLDs like .co.uk - you will need to explicitly set the domain here."
      },
      {
        "type": "TEXT",
        "name": "firstPartyLeadEndpoint",
        "displayName": "First Party Lead Endpoint",
        "simpleValueType": true,
        "valueValidators": []
      },
      {
        "type": "TEXT",
        "name": "decorateHostnames",
        "displayName": "Cross Domain Link Decoration",
        "simpleValueType": true,
        "help": "Enter a comma separated list of domains here and clicks on links will result in the existing campaign data appended as a query string. This is only needed if you need to persist campaign data between 2 or more root domains.\u003cbr\u003e\u003cbr\u003e\n\n\u003cstrong\u003eNote -- subdomains do NOT require link decoration.\u003c/strong\u003e",
        "valueHint": "domain-a.com, domain-b.com"
      },
      {
        "type": "CHECKBOX",
        "name": "enableSpaSupport",
        "checkboxText": "Enable SPA Support",
        "simpleValueType": true,
        "help": "If you need to support single-page-applications, check this to ensure the session cookies are extended properly."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "config",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "formId",
    "displayName": "Form ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "lead",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "userData",
    "displayName": "User Data",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Property",
        "name": "property",
        "type": "SELECT",
        "selectItems": [
          {
            "value": "first_name",
            "displayValue": "First Name"
          },
          {
            "value": "last_name",
            "displayValue": "Last Name"
          },
          {
            "value": "email",
            "displayValue": "Email"
          },
          {
            "value": "phone",
            "displayValue": "Phone"
          },
          {
            "value": "city",
            "displayValue": "City"
          },
          {
            "value": "region",
            "displayValue": "Region (e.g. State/Province)"
          },
          {
            "value": "postal_code",
            "displayValue": "Postal Code"
          },
          {
            "value": "country",
            "displayValue": "Country"
          },
          {
            "value": "date_of_birth",
            "displayValue": "Date of Birth"
          },
          {
            "value": "gender",
            "displayValue": "Gender"
          }
        ],
        "isUnique": true
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "isUnique": true
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "lead",
        "type": "EQUALS"
      }
    ],
    "help": "All user data values are normalized and SHA256 hashed."
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "properties",
    "displayName": "Properties",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Name",
        "name": "property",
        "type": "TEXT",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "REGEX",
            "args": [
              "^[a-z][a-z_]+"
            ]
          }
        ],
        "isUnique": true,
        "valueHint": ""
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "REGEX",
            "args": [
              ".{1,100}"
            ]
          }
        ],
        "isUnique": false
      }
    ],
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "lead",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const addConsentListener = require('addConsentListener');
const callInWindow = require('callInWindow');
const getType = require('getType');
const injectScript = require('injectScript');
const isConsentGranted = require('isConsentGranted');
const log = require('logToConsole');
const makeNumber = require('makeNumber');
const makeString = require('makeString');
const makeTableMap = require('makeTableMap');

// Begin Template Code

const globalStore = '_campaignCollector';
const sdk = 'gtm-tpl@1.0';
const scriptSrc = 'https://cdn.jsdelivr.net/gh/levelinteractive/campaign-collector@latest/dist/core.min.js';

const methodPath = (method) => [globalStore, data.instanceKey, method].join('.');

if (data.type == 'config') {
  
  injectScript(scriptSrc, () => {

    const config = {
      debug: false,
      fieldMap: {
        first: {},
        last: {},
      },
      sdk: sdk,
      userDataHash: {
        city: true,
        postal_code: true,
      }
    };
    
    if (data.fieldMapAnonymousId)
      config.fieldMap.anonymous_id = data.fieldMapAnonymousId;
    
    if (data.fieldMapAttributionJson)
      config.fieldMap.attribution = data.fieldMapAttributionJson;
    
    if (data.fieldMapAttributionJson)
      config.fieldMap.consent = data.fieldMapConsent;

    // First & Last Touch

    if (data.fieldMapStandardFirst)
      config.fieldMap.first['utm'] = makeTableMap(data.fieldMapStandardFirst, 'parameter', 'field');

    if (data.fieldMapCustomFirst)
      config.fieldMap.first['$ns'] = makeTableMap(data.fieldMapCustomFirst, 'parameter', 'field');


    // Last Touch

    let sessionTimeout = makeNumber(data.sessionTimeout || 30);

    if (sessionTimeout > 475)
      sessionTimeout = 475;

    if (sessionTimeout < 30)
      sessionTimeout = 30;

    config.sessionTimeout = [sessionTimeout, 'minutes'];

    if (data.fieldMapStandardLast)
      config.fieldMap.last['utm'] = makeTableMap(data.fieldMapStandardLast, 'parameter', 'field');

    if (data.fieldMapCustomLast)
      config.fieldMap.last['$ns'] = makeTableMap(data.fieldMapCustomLast, 'parameter', 'field');


    // Cookies & Globals

    if (data.fieldMapCookies)
      config.fieldMap.cookies = makeTableMap(data.fieldMapCookies, 'name', 'field');

    if (data.fieldMapGlobals)
      config.fieldMap.globals = makeTableMap(data.fieldMapGlobals, 'path', 'field');

    if ('object' == getType(data.filters)) {

      config.filters = {};

      for (let prop in data.filters) {
        if (! data.filters.hasOwnProperty(prop))
          continue;

        if ('function' === getType(data.filters[prop]))
          config.filters[prop] = data.filters[prop];
      }

    }
    
    if (data.useCommonCookieFilters) {
      
      const commonCookieFilters = {
        // GA4 Client ID
        // GA[VER].[DOMAIN INDEX].[RANDOM #].[TIME]
        _ga: value => value.split('.').slice(2).join('.'),
        
        // gclid
        // GCL.[TIME].[gclid]
        _gcl_aw: value => value.split('.')[2],
        
        // wbraid
        // GCL.[TIME].[wbraid]
        _gcl_gb: value => value.split('.')[2],
        
        // gbraid
        // 2.1.k[gbraid]$i[TIME]
        _gcl_ag: value => value.split('.').slice(2).join('').substr(1).split('$i').reverse()[1],
        
        // msclkid
        // _uet[msclkid]
        _uetmsclkid: value => value.replace('_uet', '')
      };
      
      for (let prop in commonCookieFilters) {
        if(! commonCookieFilters.hasOwnProperty(prop))
          return;
        
        config.filters[prop] = commonCookieFilters[prop];
      }
      
    }


    // Field Targeting Options

    config.fieldTargetMethod = [];

    if (data.fieldTargetByName)
      config.fieldTargetMethod.push('name');

    if (data.fieldTargetByClass)
      config.fieldTargetMethod.push('class');

    if (data.fieldTargetByParentClass)
      config.fieldTargetMethod.push('parentClass');

    if (data.fieldTargetByCustomAttribute)
      config.fieldTargetMethod.push('dataAttribute');

    if (! config.fieldTargetMethod.length)
      config.fieldTargetMethod = ['name'];


    // Misc. Options

    if (data.namespace)
      config.namespace = data.namespace;
    
    if (data.storageDomain)
      config.storageDomain = data.storageDomain;

    if (data.firstPartyLeadEndpoint)
      config.firstPartyLeadEndpoint = data.firstPartyLeadEndpoint;

    if (data.decorateHostnames) {
      config.decorateHostnames = data.decorateHostnames
        .split(',')
        .map(item => item.trim())
        .filter(item => item.length > 0);
    }

    config.enableSpaSupport = data.enableSpaSupport;

    // Boot the instance

    callInWindow('CampaignCollector.create', config, data.instanceKey);
    
    // Consent
    
    const consentTypes = [
      'ad_personalization',
      'ad_storage',
      'ad_user_data',
      'analytics_storage',
    ];

    const consentStatus = (input) => {
      return {
        'true': 'granted',
        'false': 'denied',
        'null': null
      }[makeString(input)];
    };
    
    consentTypes.forEach((type) => {
      addConsentListener(type, (consentType, granted) => {
        callInWindow('CampaignCollector.consentChange', consentType, consentStatus(granted));
      });
    });

    data.gtmOnSuccess();

  }, data.gtmOnFailure, 'lvl:campaign-collector.js');
  
}

if (data.type == 'lead') {
  
  if (! data.formId)
    data.gtmOnFailure();
  
  let payload = {
    properties: makeTableMap(data.properties, 'property', 'value'),
    userData: makeTableMap(data.userData, 'property', 'value'),
  };
  
  payload.properties.form_id = data.formId;
  
  callInWindow(methodPath('lead'), payload.properties, payload.userData);
  
  data.gtmOnSuccess();
  
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "CampaignCollector.create"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_campaignCollector"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_campaignCollector.alpha"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_campaignCollector.beta"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_campaignCollector.alpha.lead"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_campaignCollector.beta.lead"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "CampaignCollector.consentChange"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://level-cdn.local/*"
              },
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/levelinteractive/campaign-collector@*/dist/core.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 12/05/2024, 12:05:15 PM


